{
  "version": 3,
  "file": "connection.js",
  "sourceRoot": "/Users/Mamble/Work/Bills/callImitator/http/src",
  "sources": [
    "connection.ts"
  ],
  "names": [
    "WsOpCode",
    "WsState",
    "WsFrame",
    "WsFrame.constructor",
    "WsFrame.decode",
    "WsFrame.createFrames",
    "WsFrame.createFrame",
    "WsFrame.createMetaData",
    "WsFrame.inspect",
    "WsError",
    "WsError.constructor",
    "WsError.toString",
    "WsConnection",
    "WsConnection.constructor",
    "WsConnection.version",
    "WsConnection.origin",
    "WsConnection.key",
    "WsConnection.id",
    "WsConnection.hash",
    "WsConnection.protocols",
    "WsConnection.connect",
    "WsConnection.accept",
    "WsConnection.onFrame",
    "WsConnection.onText",
    "WsConnection.onBinary",
    "WsConnection.onPong",
    "WsConnection.onPing",
    "WsConnection.onClose",
    "WsConnection.onStreamBinary",
    "WsConnection.onStreamText",
    "WsConnection.onStreamChunk",
    "WsConnection.onStreamDone",
    "WsConnection.sendFrame",
    "WsConnection.sendPing",
    "WsConnection.sendText",
    "WsConnection.sendBinary"
  ],
  "mappings": "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AIA,CAACA,MAAMA,CAACA,CAAAA,CAACA;oCACZA,MAAMA,GAAGA,MAAMA,CAACA,MAAMA,CAACA,CAACA,MAAMA,EAACA,IAAIA,CAACA,CAACA,CAACA;oCACtCA,IAAIA,KAAKA,GAAGA,OAAOA,CAACA,MAAMA,CAACA,MAAMA,EAACA,QAAQA,CAACA,CAACA;oCAC5CA,EAAEA,CAAAA,CAACA,KAAKA,CAACA,CAAAA,CAACA;wCACNA,MAAMA,GAAGA,MAAMA,CAACA,KAAKA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;wCAClCA,KAAIA,CAACA,OAAOA,CAACA,KAAKA,CAACA,CAACA;oCACxBA,CAACA;gCACLA,CAACA;4BACLA,CAACA,CAACA,CAACA;4BACHA,CAACA,CAACA,EAAEA,CAACA,OAAOA,EAACA,UAACA,EAAUA;gCACpBA,wBAAwBA;4BAC5BA,CAACA,CAACA,CAACA;4BACHA,CAACA,CAACA,EAAEA,CAACA,KAAKA,EAAEA,UAACA,IAAKA;gCACdA,iCAAiCA;gCACjCA,EAAEA,CAAAA,CAACA,IAAIA,IAAIA,IAAIA,CAACA,MAAMA,CAACA,CAAAA,CAACA;oCACpBA,MAAMA,GAAGA,MAAMA,CAACA,MAAMA,CAACA,CAACA,MAAMA,EAACA,IAAIA,CAACA,CAACA,CAACA;oCACtCA,IAAIA,KAAKA,GAAGA,OAAOA,CAACA,MAAMA,CAACA,MAAMA,EAACA,QAAQA,CAACA,CAACA;oCAC5CA,EAAEA,CAAAA,CAACA,KAAKA,CAACA,CAAAA,CAACA;wCACNA,MAAMA,GAAGA,MAAMA,CAACA,KAAKA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;wCAClCA,KAAIA,CAACA,OAAOA,CAACA,KAAKA,CAACA,CAACA;oCACxBA,CAACA;gCACLA,CAACA;4BACLA,CAACA,CAACA,CAACA;4BACHA,CAACA,CAACA,EAAEA,CAACA,OAAOA,EAAEA,UAACA,CAAQA;gCACnBA,OAAOA,CAACA,IAAIA,CAACA,SAASA,EAACA,CAACA,CAACA,KAAKA,CAACA,CAACA;gCAChCA,CAACA,CAACA,OAAOA,EAAEA,CAACA;4BAChBA,CAACA,CAACA,CAACA;4BACHA,MAAMA,CAACA,cAAcA,CAACA,KAAIA,EAACA,QAAQA,EAAqBA;gCACpDA,UAAUA,EAAQA,KAAKA;gCACvBA,YAAYA,EAAMA,KAAKA;gCACvBA,KAAKA,EAAaA,CAACA;6BACtBA,CAACA,CAACA;4BACHA,KAAIA,CAACA,MAAMA,GAAGA,WAAWA,CAACA;gCACtBA,KAAIA,CAACA,QAAQA,EAAEA,CAACA;4BACpBA,CAACA,EAACA,IAAIA,CAACA,CAACA;wBACZA,CAACA;qBACJA,CAACA,CAACA;oBACHA,MAAMA,CAACA,cAAcA,CAACA,IAAIA,EAACA,SAASA,EAAqBA;wBACrDA,UAAUA,EAAQA,KAAKA;wBACvBA,YAAYA,EAAMA,IAAIA;wBACtBA,GAAGA,EAAeA,UAACA,CAACA;4BAChBA,MAAMA,CAACA,cAAcA,CAACA,KAAIA,EAACA,SAASA,EAAqBA;gCACrDA,UAAUA,EAAQA,KAAKA;gCACvBA,YAAYA,EAAMA,KAAKA;gCACvBA,KAAKA,EAAaA,CAACA;6BACtBA,CAACA,CAACA;wBACPA,CAACA;qBACJA,CAACA,CAACA;oBACHA,MAAMA,CAACA,cAAcA,CAACA,IAAIA,EAACA,QAAQA,EAAqBA;wBACpDA,UAAUA,EAAQA,KAAKA;wBACvBA,YAAYA,EAAMA,IAAIA;wBACtBA,GAAGA,EAAeA,UAACA,CAACA;4BAChBA,MAAMA,CAACA,cAAcA,CAACA,KAAIA,EAACA,QAAQA,EAAqBA;gCACpDA,UAAUA,EAAQA,KAAKA;gCACvBA,YAAYA,EAAMA,KAAKA;gCACvBA,KAAKA,EAAaA,CAACA;6BACtBA,CAACA,CAACA;wBACPA,CAACA;qBACJA,CAACA,CAACA;gBAEPA,CAACA;gBAzHDD,sBAAIA,iCAAOA;yBAAXA;wBACIE,MAAMA,CAACA,IAAIA,CAACA,OAAOA,CAACA,uBAAuBA,CAACA,CAACA,WAAWA,EAAEA,CAACA;oBAC/DA,CAACA;;;mBAAAF;gBACDA,sBAAIA,gCAAMA;yBAAVA;wBACIG,MAAMA,CAACA,IAAIA,CAACA,OAAOA,CAACA,QAAQA,CAACA,CAACA,WAAWA,EAAEA,CAACA;oBAChDA,CAACA;;;mBAAAH;gBACDA,sBAAIA,6BAAGA;yBAAPA;wBACII,MAAMA,CAACA,IAAIA,CAACA,OAAOA,CAACA,mBAAmBA,CAACA,CAACA;oBAC7CA,CAACA;;;mBAAAJ;gBACDA,sBAAIA,4BAAEA;yBAANA;wBACIK,MAAMA,CAACA,MAAMA,CAACA,cAAcA,CAACA,IAAIA,EAACA,IAAIA,EAAqBA;4BACvDA,UAAUA,EAACA,IAAIA;4BACfA,QAAQA,EAACA,KAAKA;4BACdA,YAAYA,EAACA,KAAKA;4BAClBA,KAAKA,EAACA,MAAMA;iCACPA,UAAUA,CAACA,KAAKA,CAACA;iCACjBA,MAAMA,CAACA,IAAIA,CAACA,IAAIA,EAACA,OAAOA,CAACA;iCACzBA,MAAMA,CAACA,KAAKA,CAACA;yBACrBA,CAACA,CAACA,EAAEA,CAACA;oBACVA,CAACA;;;mBAAAL;gBACDA,sBAAIA,8BAAIA;yBAARA;wBACIM,MAAMA,CAACA,MAAMA,CAACA,cAAcA,CAACA,IAAIA,EAACA,MAAMA,EAAqBA;4BACzDA,UAAUA,EAACA,IAAIA;4BACfA,QAAQA,EAACA,KAAKA;4BACdA,YAAYA,EAACA,KAAKA;4BAClBA,KAAKA,EAACA,MAAMA;iCACPA,UAAUA,CAACA,MAAMA,CAACA;iCAClBA,MAAMA,CAAIA,IAAIA,CAACA,GAAGA,yCAAsCA,EAACA,OAAOA,CAACA;iCACjEA,MAAMA,CAACA,QAAQA,CAACA;yBACxBA,CAACA,CAACA,IAAIA,CAACA;oBACZA,CAACA;;;mBAAAN;gBACDA,sBAAIA,mCAASA;yBAAbA;wBACIO,MAAMA,CAACA,MAAMA,CAACA,IAAIA,CAACA,OAAOA,CAACA,wBAAwBA,CAACA,CAACA;6BAChDA,IAAIA,EAAEA;6BACNA,WAAWA,EAAEA;6BACbA,KAAKA,CAACA,GAAGA,CAACA;6BACVA,GAAGA,CAACA,UAAAA,CAACA,IAAEA,OAAAA,CAACA,IAAEA,CAACA,CAACA,IAAIA,EAAEA,EAAXA,CAAWA,CAACA,CAACA;oBAC7BA,CAACA;;;mBAAAP;gBAsFMA,8BAAOA,GAAdA;oBACIQ,IAAIA,CAACA,MAAMA,GAAGA,KAAKA,CAACA;oBACpBA,MAAMA,CAACA,IAAIA,CAACA;gBAChBA,CAACA;gBACMR,6BAAMA,GAAbA,UAAcA,OAAuBA,EAACA,QAAeA;oBACjDS,IAAIA,CAACA,MAAMA,GAAGA,IAAIA,CAACA;oBACnBA,IAAIA,CAACA,OAAOA,GAAGA,OAAOA,CAACA,OAAOA,CAACA;oBAC/BA,EAAEA,CAAAA,CAACA,IAAIA,CAACA,OAAOA,IAAIA,IAAIA,CAACA,CAACA,CAACA;wBACtBA,MAAMA,IAAIA,OAAOA,CAACA,GAAGA,EAACA,gCAA8BA,IAAIA,CAACA,OAASA,CAACA,CAACA;oBACxEA,CAACA;oBAACA,IAAIA,CACNA,EAAEA,CAAAA,CAACA,IAAIA,CAACA,SAASA,CAACA,OAAOA,CAACA,QAAQA,CAACA,GAACA,CAACA,CAACA,CAAAA,CAACA;wBACnCA,MAAMA,CAACA,KAAKA,CAACA;oBACjBA,CAACA;oBAAAA,IAAIA,CAAAA,CAACA;wBACFA,IAAIA,CAACA,MAAMA,GAAGA,OAAOA,CAACA,MAAMA,CAACA;wBAC7BA,MAAMA,CAACA,IAAIA,CAACA;oBAChBA,CAACA;gBACLA,CAACA;gBAEST,8BAAOA,GAAjBA,UAAkBA,KAAaA;oBAC3BU,IAAIA,CAACA,IAAIA,CAACA,OAAOA,EAACA,KAAKA,CAACA,CAACA;oBACzBA,EAAEA,CAAAA,CAACA,KAAKA,CAACA,GAAGA,CAACA,CAAAA,CAACA;wBACVA,MAAMA,CAAAA,CAACA,KAAKA,CAACA,EAAEA,CAACA,CAAAA,CAACA;4BACbA,KAAKA,QAAQA,CAACA,MAAMA,EAAGA,MAAMA,CAACA,IAAIA,CAACA,QAAQA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;4BACxDA,KAAKA,QAAQA,CAACA,IAAIA,EAAGA,MAAMA,CAACA,IAAIA,CAACA,MAAMA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;4BACpDA,KAAKA,QAAQA,CAACA,IAAIA,EAAGA,MAAMA,CAACA,IAAIA,CAACA,MAAMA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;4BACpDA,KAAKA,QAAQA,CAACA,IAAIA,EAAGA,MAAMA,CAACA,IAAIA,CAACA,MAAMA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;4BACpDA,KAAKA,QAAQA,CAACA,KAAKA,EAAGA,MAAMA,CAACA,IAAIA,CAACA,OAAOA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;4BACtDA,KAAKA,QAAQA,CAACA,KAAKA,EAAGA,MAAMA,CAACA,IAAIA,CAACA,YAAYA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;4BAC3DA,SAAUA,MAAMA,IAAIA,KAAKA,CAACA,eAAeA,CAACA,CAAAA;wBAC9CA,CAACA;oBACLA,CAACA;oBAAAA,IAAIA,CAAAA,CAACA;wBACFA,MAAMA,CAAAA,CAACA,KAAKA,CAACA,EAAEA,CAACA,CAAAA,CAACA;4BACbA,KAAKA,QAAQA,CAACA,MAAMA,EAAMA,MAAMA,CAACA,IAAIA,CAACA,cAAcA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;4BACjEA,KAAKA,QAAQA,CAACA,IAAIA,EAAQA,MAAMA,CAACA,IAAIA,CAACA,YAAYA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;4BAC/DA,KAAKA,QAAQA,CAACA,KAAKA,EAAOA,MAAMA,CAACA,IAAIA,CAACA,aAAaA,CAACA,KAAKA,CAACA,IAAIA,CAACA,CAACA;4BAChEA,SAAUA,MAAMA,IAAIA,KAAKA,CAACA,eAAeA,CAACA,CAAAA;wBAC9CA,CAACA;oBACLA,CAACA;gBAELA,CAACA;gBACSV,6BAAMA,GAAhBA,UAAiBA,MAAaA;oBAC1BW,IAAIA,CAACA,IAAIA,CAACA,MAAMA,EAACA,MAAMA,CAACA,QAAQA,EAAEA,CAACA,CAACA;gBACxCA,CAACA;gBACSX,+BAAQA,GAAlBA,UAAmBA,MAAaA;oBAC5BY,IAAIA,CAACA,IAAIA,CAACA,QAAQA,EAACA,MAAMA,CAACA,CAACA;gBAC/BA,CAACA;gBACSZ,6BAAMA,GAAhBA,UAAiBA,MAAaA;oBAC1Ba,IAAIA,IAAIA,GAAIA,MAAMA,CAACA,QAAQA,EAAEA,CAACA;oBAC9BA,uDAAuDA;oBACvDA,IAAIA,CAACA,IAAIA,GAAGA,IAAIA,CAACA;oBACjBA,IAAIA,CAACA,IAAIA,CAACA,MAAMA,EAACA,IAAIA,CAACA,CAACA;gBAC3BA,CAACA;gBACSb,6BAAMA,GAAhBA,UAAiBA,MAAaA;oBAC1Bc,0BAA0BA;oBAC1BA,IAAIA,CAACA,IAAIA,CAACA,MAAMA,EAACA,MAAMA,CAACA,CAACA;oBACzBA,IAAIA,CAACA,SAASA,CAACA,QAAQA,CAACA,IAAIA,EAACA,MAAMA,CAACA,CAACA;gBACzCA,CAACA;gBACSd,8BAAOA,GAAjBA,UAAkBA,MAAaA;oBAC3Be,IAAIA,IAAIA,GAAMA,CAACA,CAACA;oBAChBA,IAAIA,OAAOA,GAAGA,EAAEA,CAACA;oBACjBA,EAAEA,CAAAA,CAACA,MAAMA,CAACA,CAAAA,CAACA;wBACPA,IAAIA,GAAMA,MAAMA,CAACA,YAAYA,CAACA,CAACA,CAACA,CAACA;wBACjCA,OAAOA,GAAGA,MAAMA,CAACA,QAAQA,CAACA,MAAMA,EAACA,CAACA,CAACA,CAACA;oBACxCA,CAACA;oBACDA,aAAaA,CAACA,IAAIA,CAACA,MAAMA,CAACA,CAACA;oBAC3BA,IAAIA,CAACA,IAAIA,CAACA,OAAOA,EAACA,IAAIA,EAACA,OAAOA,CAACA,CAACA;gBACpCA,CAACA;gBACSf,qCAAcA,GAAxBA,UAAyBA,MAAaA;oBAClCgB,IAAIA,CAACA,OAAOA,GAAGA,QAAQA,CAACA,MAAMA,CAACA;oBAC/BA,EAAEA,CAAAA,CAACA,IAAIA,CAACA,SAASA,CAACA,QAAQA,CAACA,CAACA,MAAMA,CAACA,CAAAA,CAACA;wBAChCA,IAAIA,CAACA,IAAIA,CAACA,QAAQA,EAACA,MAAMA,EAACA,IAAIA,CAACA,OAAOA,EAACA,OAAOA,CAACA,CAACA;oBACpDA,CAACA;oBAAAA,IAAIA,CAAAA,CAACA;wBACFA,IAAIA,CAACA,aAAaA,GAAGA,MAAMA,CAAAA;oBAC/BA,CAACA;gBACLA,CAACA;gBACShB,mCAAYA,GAAtBA,UAAuBA,MAAaA;oBAChCiB,IAAIA,CAACA,OAAOA,GAAGA,QAAQA,CAACA,IAAIA,CAACA;oBAC7BA,EAAEA,CAAAA,CAACA,IAAIA,CAACA,SAASA,CAACA,QAAQA,CAACA,CAACA,MAAMA,CAACA,CAAAA,CAACA;wBAChCA,IAAIA,CAACA,IAAIA,CAACA,QAAQA,EAACA,MAAMA,EAACA,IAAIA,CAACA,OAAOA,EAACA,OAAOA,CAACA,CAACA;oBACpDA,CAACA;oBAAAA,IAAIA,CAAAA,CAACA;wBACFA,IAAIA,CAACA,aAAaA,GAAGA,MAAMA,CAAAA;oBAC/BA,CAACA;gBACLA,CAACA;gBACSjB,oCAAaA,GAAvBA,UAAwBA,MAAaA;oBACjCkB,EAAEA,CAAAA,CAACA,IAAIA,CAACA,SAASA,CAACA,QAAQA,CAACA,CAACA,MAAMA,CAACA,CAAAA,CAACA;wBAChCA,IAAIA,CAACA,IAAIA,CAACA,QAAQA,EAACA,MAAMA,EAACA,IAAIA,CAACA,OAAOA,EAACA,OAAOA,CAACA,CAACA;oBACpDA,CAACA;oBAAAA,IAAIA,CAAAA,CAACA;wBACFA,IAAIA,CAACA,aAAaA,GAAGA,MAAMA,CAACA,MAAMA,CAC9BA,CAACA,IAAIA,CAACA,aAAaA,EAACA,MAAMA,CAACA,EAC3BA,IAAIA,CAACA,aAAaA,CAACA,MAAMA,GAACA,MAAMA,CAACA,MAAMA,CAC1CA,CAACA;oBACNA,CAACA;gBACLA,CAACA;gBACSlB,mCAAYA,GAAtBA,UAAuBA,MAAaA;oBAChCmB,EAAEA,CAAAA,CAACA,IAAIA,CAACA,SAASA,CAACA,QAAQA,CAACA,CAACA,MAAMA,CAACA,CAAAA,CAACA;wBAChCA,IAAIA,CAACA,IAAIA,CAACA,QAAQA,EAACA,MAAMA,EAACA,IAAIA,CAACA,OAAOA,EAACA,OAAOA,CAACA,CAACA;oBACpDA,CAACA;oBAAAA,IAAIA,CAAAA,CAACA;wBACFA,IAAIA,CAACA,aAAaA,GAAGA,MAAMA,CAACA,MAAMA,CAC9BA,CAACA,IAAIA,CAACA,aAAaA,EAACA,MAAMA,CAACA,EAC3BA,IAAIA,CAACA,aAAaA,CAACA,MAAMA,GAACA,MAAMA,CAACA,MAAMA,CAC1CA,CAACA;wBACFA,MAAMA,CAAAA,CAACA,IAAIA,CAACA,OAAOA,CAACA,CAAAA,CAACA;4BACjBA,KAAKA,QAAQA,CAACA,IAAIA;gCAAGA,IAAIA,CAACA,MAAMA,CAACA,IAAIA,CAACA,aAAaA,CAACA,CAACA;gCAACA,KAAKA,CAACA;4BAC5DA,KAAKA,QAAQA,CAACA,MAAMA;gCAAGA,IAAIA,CAACA,QAAQA,CAACA,IAAIA,CAACA,aAAaA,CAACA,CAACA;gCAACA,KAAKA,CAACA;wBACpEA,CAACA;wBACDA,IAAIA,CAACA,OAAOA,GAACA,IAAIA,CAACA;wBAClBA,IAAIA,CAACA,aAAaA,GAACA,IAAIA,CAACA;oBAC5BA,CAACA;gBACLA,CAACA;gBACSnB,gCAASA,GAAnBA,UAAoBA,EAAWA,EAACA,IAAWA;oBAA3CoB,iBAYCA;oBAXGA,IAAIA,CAACA,KAAKA,CAACA,IAAIA,CAACA,EAACA,IAAAA,EAAEA,EAACA,MAAAA,IAAIA,EAACA,CAACA,CAACA;oBAC3BA,EAAEA,CAAAA,CAACA,IAAIA,CAACA,KAAKA,CAACA,MAAMA,IAAEA,CAACA,CAACA,CAAAA,CAACA;wBACrBA,OAAOA,IAAIA,CAACA,KAAKA,CAACA,MAAMA,EAAEA,CAACA;4BACvBA,IAAIA,EAAEA,GAAYA,IAAIA,CAACA,KAAKA,CAACA,CAACA,CAACA,CAACA,EAAEA,CAACA;4BACnCA,IAAIA,IAAIA,GAAUA,IAAIA,CAACA,KAAKA,CAACA,CAACA,CAACA,CAACA,IAAIA,CAACA;4BACrCA,OAAOA,CAACA,YAAYA,CAACA,EAAEA,EAAEA,IAAIA,EAAEA,UAACA,KAAYA;gCACxCA,KAAIA,CAACA,MAAMA,CAACA,KAAKA,CAACA,KAAKA,CAACA,CAACA;4BAC7BA,CAACA,CAACA,CAACA;4BACHA,IAAIA,CAACA,KAAKA,CAACA,KAAKA,EAAEA,CAACA;wBACvBA,CAACA;oBACLA,CAACA;gBACLA,CAACA;gBACSpB,+BAAQA,GAAlBA;oBACIqB,EAAEA,CAAAA,CAACA,CAACA,IAAIA,CAACA,IAAIA,CAACA,CAAAA,CAACA;wBACXA,IAAIA,CAACA,IAAIA,GAACA,IAAIA,IAAIA,EAAEA,CAACA,WAAWA,EAAEA,CAACA;wBACnCA,IAAIA,CAACA,SAASA,CAACA,QAAQA,CAACA,IAAIA,EAACA,IAAIA,MAAMA,CAACA,IAAIA,CAACA,IAAIA,CAACA,CAACA,CAACA;oBACxDA,CAACA;gBACLA,CAACA;gBACMrB,+BAAQA,GAAfA,UAAgBA,IAAWA;oBACvBsB,IAAIA,CAACA,SAASA,CAACA,QAAQA,CAACA,IAAIA,EAACA,IAAIA,MAAMA,CAACA,IAAIA,CAACA,CAACA,CAAAA;gBAClDA,CAACA;gBACMtB,iCAAUA,GAAjBA,UAAkBA,MAAaA;oBAC3BuB,IAAIA,CAACA,SAASA,CAACA,QAAQA,CAACA,MAAMA,EAACA,MAAMA,CAACA,CAAAA;gBAC1CA,CAACA;gBAELvB,mBAACA;YAADA,CAACA,AA9QD,EAAkC,qBAAY,EA8Q7C;YA9QD,uCA8QC,CAAA",
  "sourcesContent": [
    "import {Socket} from \"node/net\";\nimport {EventEmitter} from \"node/events\";\nimport {IncomingMessage} from \"node/http\";\nimport * as CRYPTO from 'node/crypto';\n\n\nexport enum WsOpCode {\n    CHUNK   = 0x00,\n    TEXT    = 0x01,\n    BINARY  = 0x02,\n    CLOSE   = 0x08,\n    PING    = 0x09,\n    PONG    = 0x0A\n}\nexport enum WsState {\n    CONNECTING,OPEN\n}\n\nexport class WsFrame {\n    static MAX_SIZE = 128 * 1024;\n    static decode(data:Buffer,isServer:boolean):WsFrame{\n        var fin, opcode, B, HB, mask, len, payload, start, i, hasMask;\n\n        if (data.length < 2) {\n            return\n        }\n        // Is this the last frame in a sequence?\n        B = data[0];\n        HB = B >> 4;\n        if (HB % 8) {\n            // RSV1, RSV2 and RSV3 must be clear\n            return null\n        }\n        fin = HB === 8;\n        opcode = B % 16;\n\n        if (opcode !== 0 && opcode !== 1 && opcode !== 2 &&\n            opcode !== 8 && opcode !== 9 && opcode !== 10) {\n            // Invalid opcode\n            return null\n        }\n        if (opcode >= 8 && !fin) {\n            // Control frames must not be fragmented\n            return null\n        }\n        B = data[1];\n        hasMask = B >> 7;\n        if ((isServer && !hasMask) || (!isServer && hasMask)) {\n            // Frames sent by clients must be masked\n            return null\n        }\n        len = B % 128;\n        start = hasMask ? 6 : 2;\n        if (data.length < start + len) {\n            // Not enough data in the buffer\n            return null\n        }\n        // Get the actual payload length\n        if (len === 126) {\n            len = data.readUInt16BE(2);\n            start += 2\n        } else\n        if (len === 127) {\n            // Warning: JS can only store up to 2^53 in its number format\n            len = data.readUInt32BE(2) * Math.pow(2, 32) + data.readUInt32BE(6);\n            start += 8\n        }\n        if (data.length < start + len) {\n            return null\n        }\n        // Extract the payload\n        payload = data.slice(start, start + len);\n        if (hasMask) {\n            // Decode with the given mask\n            mask = data.slice(start - 4, start);\n            for (i = 0; i < payload.length; i++) {\n                payload[i] ^= mask[i % 4]\n            }\n        }\n        return new WsFrame(fin,opcode,payload,start + len);\n    }\n    static createFrames(op:WsOpCode,data:Buffer,handler:(b:Buffer)=>void){\n        var start = 0, end = start+WsFrame.MAX_SIZE, first=true;\n        while(start<data.length){\n            var first = start==0;\n            var end = Math.min(start + WsFrame.MAX_SIZE,data.length);\n            var buffer = data.slice(start,start=end);\n            handler(this.createFrame(first?op:WsOpCode.CHUNK,buffer,end>=data.length));\n        }\n    }\n    static createFrame(op:WsOpCode,data:Buffer,fin:boolean=true,masked:boolean=false):Buffer {\n        var payload, meta;\n        if (masked) {\n            payload = new Buffer(data.length);\n            data.copy(payload)\n        } else {\n            payload = data;\n        }\n        meta = this.createMetaData(fin, op, masked, payload);\n        return Buffer.concat([meta, payload], meta.length + payload.length)\n    }\n    static createMetaData(fin:boolean, opcode:WsOpCode, masked:boolean, payload:Buffer) {\n        var len, meta, start, mask, i;\n        len = payload.length;\n        // Creates the buffer for meta-data\n        meta = new Buffer(2 + (len < 126 ? 0 : (len < 65536 ? 2 : 8)) + (masked ? 4 : 0))\n        // Sets fin and opcode\n        meta[0] = (fin ? 128 : 0) + opcode;\n        // Sets the mask and length\n        meta[1] = masked ? 128 : 0;\n        start = 2;\n        if (len < 126) {\n            meta[1] += len\n        } else if (len < 65536) {\n            meta[1] += 126;\n            meta.writeUInt16BE(len, 2);\n            start += 2\n        } else {\n            // Warning: JS doesn't support integers greater than 2^53\n            meta[1] += 127;\n            meta.writeUInt32BE(Math.floor(len / Math.pow(2, 32)), 2);\n            meta.writeUInt32BE(len % Math.pow(2, 32), 6);\n            start += 8\n        }\n\n        // Set the mask-key\n        if (masked) {\n            mask = new Buffer(4);\n            for (i = 0; i < 4; i++) {\n                meta[start + i] = mask[i] = Math.floor(Math.random() * 256)\n            }\n            for (i = 0; i < payload.length; i++) {\n                payload[i] ^= mask[i % 4]\n            }\n            start += 4\n        }\n\n        return meta\n    }\n\n    public fin:boolean;\n    public op:WsOpCode;\n    public data:Buffer;\n    public size:number;\n    public code:number;\n\n    constructor(fin:boolean,opcode:WsOpCode,payload:Buffer,size:number){\n        this.fin = fin;\n        this.op = opcode;\n        this.size = size;\n        this.data = payload;\n    }\n    inspect(){\n        var length = this.data?this.data.length:0;\n        return {\n            fin     : this.fin,\n            op      : this.op,\n            size    : this.size,\n            length  : this.size-length\n        }\n    }\n}\n\nexport class WsError extends Error {\n    public code:number;\n    constructor(code,message){\n        super(message);\n        this.code = code;\n    }\n    toString(){\n        return `${this.code} ${this.message}`;\n    }\n}\nexport class WsConnection extends EventEmitter{\n\n    protected server:boolean;\n    protected state:WsState;\n    protected headers:any;\n    protected socket:Socket;\n\n    private reading:WsOpCode;\n    private readingBuffer:Buffer;\n\n    private queue:{op:WsOpCode,data:Buffer}[];\n\n    get version():string{\n        return this.headers['sec-websocket-version'].toLowerCase();\n    }\n    get origin():string{\n        return this.headers['origin'].toLowerCase();\n    }\n    get key():string{\n        return this.headers['sec-websocket-key'];\n    }\n    get id():string{\n        return Object.defineProperty(this,'id',<PropertyDescriptor>{\n            enumerable:true,\n            writable:false,\n            configurable:false,\n            value:CRYPTO\n                .createHash('md5')\n                .update(this.hash,'ascii')\n                .digest('hex')\n        }).id;\n    }\n    get hash():string{\n        return Object.defineProperty(this,'hash',<PropertyDescriptor>{\n            enumerable:true,\n            writable:false,\n            configurable:false,\n            value:CRYPTO\n                .createHash('sha1')\n                .update(`${this.key}258EAFA5-E914-47DA-95CA-C5AB0DC85B11`,'ascii')\n                .digest('base64')\n        }).hash;\n    }\n    get protocols():string[]{\n        return String(this.headers['sec-websocket-protocol'])\n            .trim()\n            .toLowerCase()\n            .split(',')\n            .map(p=>p&&p.trim());\n    }\n    \n    private ping:string;\n    private pinger:any;\n    constructor(isServer:boolean){\n        super();\n        var socket,headers,state=WsState.CONNECTING,buffer=new Buffer(0);\n        this.queue=[];\n        Object.defineProperty(this,'state',<PropertyDescriptor>{\n            enumerable  : false,\n            get         : ()=>state,\n            set         : (v)=>state=v\n        });\n        Object.defineProperty(this,'socket',<PropertyDescriptor>{\n            enumerable   : false,\n            configurable : true,\n            set          : (v)=>{\n                v.on('close',(ok:boolean)=>{\n                    this.onClose(new Buffer(ok?\"0001\":\"0000\"));\n                });\n                v.on('connect',(ok:boolean)=>{\n                    console.info('connect',ok);\n                });\n                v.on('data', (data)=>{\n                    if(data.length){\n                        buffer = Buffer.concat([buffer,data]);\n                        var frame = WsFrame.decode(buffer,isServer);\n                        if(frame){\n                            buffer = buffer.slice(frame.size);\n                            this.onFrame(frame);\n                        }\n                    }\n                });\n                v.on('drain',(ok:boolean)=>{\n                    //console.info('drain');\n                });\n                v.on('end', (data?)=>{\n                    //console.info(\"END SOCKET END\");\n                    if(data && data.length){\n                        buffer = Buffer.concat([buffer,data]);\n                        var frame = WsFrame.decode(buffer,isServer);\n                        if(frame){\n                            buffer = buffer.slice(frame.size);\n                            this.onFrame(frame);\n                        }\n                    }\n                });\n                v.on('error', (e?:Error)=>{\n                    console.info('onError',e.stack);\n                    v.destroy();\n                });\n                Object.defineProperty(this,'socket',<PropertyDescriptor>{\n                    enumerable      : false,\n                    configurable    : false,\n                    value           : v\n                });\n                this.pinger = setInterval(()=>{\n                    this.sendPing();\n                },5000);\n            }\n        });\n        Object.defineProperty(this,'headers',<PropertyDescriptor>{\n            enumerable      : false,\n            configurable    : true,\n            set             : (v)=>{\n                Object.defineProperty(this,'headers',<PropertyDescriptor>{\n                    enumerable      : false,\n                    configurable    : false,\n                    value           : v\n                });\n            }\n        });\n        Object.defineProperty(this,'server',<PropertyDescriptor>{\n            enumerable      : false,\n            configurable    : true,\n            set             : (v)=>{\n                Object.defineProperty(this,'server',<PropertyDescriptor>{\n                    enumerable      : false,\n                    configurable    : false,\n                    value           : v\n                });\n            }\n        });\n\n    }\n\n    public connect(){\n        this.server = false;\n        return true;\n    }\n    public accept(request:IncomingMessage,protocol:string):boolean{\n        this.server = true;\n        this.headers = request.headers;\n        if(this.version != '13') {\n            throw new WsError(400,`Unsupported Socket Version ${this.version}`);\n        } else\n        if(this.protocols.indexOf(protocol)<0){\n            return false;\n        }else{\n            this.socket = request.socket;\n            return true;\n        }\n    }\n\n    protected onFrame(frame:WsFrame){\n        this.emit('frame',frame);\n        if(frame.fin){\n            switch(frame.op){\n                case WsOpCode.BINARY : return this.onBinary(frame.data);\n                case WsOpCode.TEXT : return this.onText(frame.data);\n                case WsOpCode.PONG : return this.onPong(frame.data);\n                case WsOpCode.PING : return this.onPing(frame.data);\n                case WsOpCode.CLOSE : return this.onClose(frame.data);\n                case WsOpCode.CHUNK : return this.onStreamDone(frame.data);\n                default : throw new Error('Invalid Frame')\n            }\n        }else{\n            switch(frame.op){\n                case WsOpCode.BINARY    : return this.onStreamBinary(frame.data);\n                case WsOpCode.TEXT      : return this.onStreamText(frame.data);\n                case WsOpCode.CHUNK     : return this.onStreamChunk(frame.data);\n                default : throw new Error('Invalid Frame')\n            }\n        }\n\n    }\n    protected onText(buffer:Buffer){\n        this.emit('text',buffer.toString());\n    }\n    protected onBinary(buffer:Buffer){\n        this.emit('binary',buffer);\n    }\n    protected onPong(buffer:Buffer){\n        var time  = buffer.toString();\n        //console.info(\"ON PONG\",this.id,time,time==this.ping);\n        this.ping = null;\n        this.emit('pong',time);\n    }\n    protected onPing(buffer:Buffer){\n        //console.info(\"ON PING\");\n        this.emit('ping',buffer);\n        this.sendFrame(WsOpCode.PONG,buffer);\n    }\n    protected onClose(buffer:Buffer){\n        var code    = 0;\n        var message = \"\";\n        if(buffer){\n            code    = buffer.readUInt16BE(0);\n            message = buffer.toString('utf8',2);\n        }\n        clearInterval(this.pinger);\n        this.emit('close',code,message);\n    }\n    protected onStreamBinary(buffer:Buffer){\n        this.reading = WsOpCode.BINARY;\n        if(this.listeners('stream').length){\n            this.emit('stream',buffer,this.reading,'start');\n        }else{\n            this.readingBuffer = buffer\n        }\n    }\n    protected onStreamText(buffer:Buffer){\n        this.reading = WsOpCode.TEXT;\n        if(this.listeners('stream').length){\n            this.emit('stream',buffer,this.reading,'start');\n        }else{\n            this.readingBuffer = buffer\n        }\n    }\n    protected onStreamChunk(buffer:Buffer){\n        if(this.listeners('stream').length){\n            this.emit('stream',buffer,this.reading,'chunk');\n        }else{\n            this.readingBuffer = Buffer.concat(\n                [this.readingBuffer,buffer],\n                this.readingBuffer.length+buffer.length\n            );\n        }\n    }\n    protected onStreamDone(buffer:Buffer){\n        if(this.listeners('stream').length){\n            this.emit('stream',buffer,this.reading,'chunk');\n        }else{\n            this.readingBuffer = Buffer.concat(\n                [this.readingBuffer,buffer],\n                this.readingBuffer.length+buffer.length\n            );\n            switch(this.reading){\n                case WsOpCode.TEXT : this.onText(this.readingBuffer); break;\n                case WsOpCode.BINARY : this.onBinary(this.readingBuffer); break;\n            }\n            this.reading=null;\n            this.readingBuffer=null;\n        }\n    }\n    protected sendFrame(op:WsOpCode,data:Buffer){\n        this.queue.push({op,data});\n        if(this.queue.length==1){\n            while (this.queue.length) {\n                var op:WsOpCode = this.queue[0].op;\n                var data:Buffer = this.queue[0].data;\n                WsFrame.createFrames(op, data, (frame:Buffer)=> {\n                    this.socket.write(frame);\n                });\n                this.queue.shift();\n            }\n        }\n    }\n    protected sendPing(){\n        if(!this.ping){\n            this.ping=new Date().toISOString();\n            this.sendFrame(WsOpCode.PING,new Buffer(this.ping));\n        }\n    }\n    public sendText(text:string){\n        this.sendFrame(WsOpCode.TEXT,new Buffer(text))\n    }\n    public sendBinary(buffer:Buffer){\n        this.sendFrame(WsOpCode.BINARY,buffer)\n    }\n\n}"
  ]
}